<div class="bg-light dark:bg-transparent min-vh-100 d-flex flex-row align-items-center">
  <c-container>
    <c-row class="justify-content-center">
      <c-col lg="7" md="9" xl="6">
        <c-card class="mx-4">
          <c-card-body class="p-4">
            <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" cForm>
              <h1>Register</h1>
              <p class="text-body-secondary">Create your account</p>

              <c-alert *ngIf="errorMessage" color="danger" [dismissible]="true" (visibleChange)="errorMessage = ''">
                {{ errorMessage }}
              </c-alert>

              <c-alert *ngIf="successMessage" color="success">
                {{ successMessage }}
              </c-alert>

              <c-input-group class="mb-3">
                <span cInputGroupText>
                  <svg cIcon name="cilUser"></svg>
                </span>
                <input
                  autoComplete="name"
                  cFormControl
                  formControlName="username"
                  placeholder="Username"
                  [valid]="f['username'].touched ? f['username'].valid : undefined"
                />
                <c-form-feedback *ngIf="f['username'].touched && f['username'].errors?.['required']" [valid]="false">
                  Username is required
                </c-form-feedback>
                <c-form-feedback *ngIf="f['username'].touched && f['username'].errors?.['minlength']" [valid]="false">
                  Username must be at least 3 characters
                </c-form-feedback>
              </c-input-group>

              <c-input-group class="mb-3">
                <span cInputGroupText>&#64;</span>
                <input
                  autoComplete="email"
                  cFormControl
                  formControlName="email"
                  placeholder="Email"
                  type="email"
                  [valid]="f['email'].touched ? f['email'].valid : undefined"
                />
                <c-form-feedback *ngIf="f['email'].touched && f['email'].errors?.['required']" [valid]="false">
                  Email is required
                </c-form-feedback>
                <c-form-feedback *ngIf="f['email'].touched && f['email'].errors?.['email']" [valid]="false">
                  Please enter a valid email
                </c-form-feedback>
              </c-input-group>

              <c-input-group class="mb-3">
                <span cInputGroupText>
                  <svg cIcon name="cilLockLocked"></svg>
                </span>
                <input
                  autoComplete="new-password"
                  cFormControl
                  formControlName="password"
                  placeholder="Password"
                  [type]="showPassword ? 'text' : 'password'"
                  [valid]="f['password'].touched ? f['password'].valid : undefined"
                />
                <span cInputGroupText style="cursor: pointer;" (click)="togglePassword()">
                  <svg cIcon [name]="showPassword ? 'cilLockUnlocked' : 'cilLockLocked'"></svg>
                </span>
                <c-form-feedback *ngIf="f['password'].touched && f['password'].errors?.['required']" [valid]="false">
                  Password is required
                </c-form-feedback>
                <c-form-feedback *ngIf="f['password'].touched && f['password'].errors?.['minlength']" [valid]="false">
                  Password must be at least 6 characters
                </c-form-feedback>
              </c-input-group>

              <c-input-group class="mb-4">
                <span cInputGroupText>
                  <svg cIcon name="cilLockLocked"></svg>
                </span>
                <input
                  autoComplete="new-password"
                  cFormControl
                  formControlName="repeatPassword"
                  placeholder="Repeat password"
                  [type]="showRepeatPassword ? 'text' : 'password'"
                  [valid]="f['repeatPassword'].touched ? (passwordMismatch ? false : f['repeatPassword'].valid) : undefined"
                />
                <span cInputGroupText style="cursor: pointer;" (click)="toggleRepeatPassword()">
                  <svg cIcon [name]="showRepeatPassword ? 'cilLockUnlocked' : 'cilLockLocked'"></svg>
                </span>
                <c-form-feedback *ngIf="f['repeatPassword'].touched && f['repeatPassword'].errors?.['required']" [valid]="false">
                  Please repeat your password
                </c-form-feedback>
                <c-form-feedback *ngIf="passwordMismatch" [valid]="false">
                  Passwords do not match
                </c-form-feedback>
              </c-input-group>

              <div class="d-grid">
                <button cButton color="success" type="submit" [disabled]="registerForm.invalid || isLoading || passwordMismatch">
                  <c-spinner *ngIf="isLoading" size="sm" class="me-2"></c-spinner>
                  {{ isLoading ? 'Creating Account...' : 'Create Account' }}
                </button>
              </div>

              <div class="text-center mt-3">
                <span class="text-body-secondary">Already have an account? </span>
                <a routerLink="/login" class="text-primary">Sign In</a>
              </div>
            </form>
          </c-card-body>
        </c-card>
      </c-col>
    </c-row>
  </c-container>
</div>
